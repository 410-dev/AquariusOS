#!/usr/bin/env bash

_snapshot_delete_completion() {
    local cur prev ids
    COMPREPLY=()

    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"

    local commands="--target --prune"

    # First argument: subcommand
    if [[ $COMP_CWORD -eq 1 ]]; then
        COMPREPLY=( $(compgen -W "${commands}" -- "$cur") )
        return 0
    fi

    # Dynamic <id> completion for commands requiring ID
    case "${COMP_WORDS[1]}" in
        --target)
            ids="$("/opt/aqua/sys/sbin/snapshot-prober.sh" --list-simple 2>/dev/null)"
            COMPREPLY=( $(compgen -W "${ids}" -- "$cur") )
            return 0
            ;;
        --prune)
            # Generate ids from 1 to 30
            ids=$(seq 1 30)
            COMPREPLY=( $(compgen -W "${ids}" -- "$cur") )
            return 0
            ;;
    esac
    return 0
}

# Bind completion to both valid command names
complete -F _features_completion snapshot-delete snapshot-delete.sh
